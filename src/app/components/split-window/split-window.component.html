<app-header></app-header>
<app-progress-bar *ngIf="loadSpinner" class="spinner_overlay"></app-progress-bar>
<ng-container *ngIf="openSplitComponent == true">
  <div class="m-1">
    <button (click)="onBackClick()" class="btn btn-primary">Back</button>
  </div>
  <div class="qnA-hr-line"></div>
  <div class="container-fluid" style="padding-top: 0.5%">
    <div class="row col-md-12">
       <div class="col-md-10 row">
        <label class="label-style" style="padding-left: 2%;">Select Data Source</label>
   <mat-form-field
   [floatLabel]="'never'"
          appearance="fill"
          class="mat-fieldcss"
          style="width: 25%; padding-left: 2%;"
        >
          <!-- <mat-label>Select Data Source</mat-label> -->

          <mat-select
            [formControl]="toppings"
            multiple
            (selectionChange)="changeAction($event)"
            [(ngModel)]="level"
          >
            <mat-option
              *ngFor="let domain of domData?.domains"
              [value]="domain"
 class="domain-style"
              >{{ domain.domainName }}</mat-option
            >
          </mat-select>
        </mat-form-field>
      </div>
      <!-- save and publish div starts here -->
      <div *ngIf="showRightPanel" class="col-md-2">
        <span  
   [matTooltipPosition]="'below'"
   [matTooltip]="disableFilterBtn ? const.saveTooltip : const.saveTooltip"><button
          type="button"
          [disabled]="disableFilterBtn"
          (click)="opensuccesspopup()"
          class="btn btn-primary save-btn-style"
        >
          Save</button
        ></span>&nbsp;&nbsp;
        <span  
        [matTooltipPosition]="'below'"
        [matTooltip]="disablePublishbtn ? const.scheduleTooltip : const.scheduleTooltip">
        <button type="button" (click)="onPublishClick()" [disabled]="disablePublishbtn"  class="btn btn-primary schedule-btn-style">Schedule</button></span>
      </div>
      <!-- save and publish div ends here -->
    </div>
  </div>

  <div class="container-fluid">
    <div class="col-md-12">
      <div class="row pad-screen">
        <!-- left pannel div code starts from here -->
        <div *ngIf="selectedDomainName" class="col-md-6">
          <div [hidden]="!showRightPanel" class="mb-3">
            <div class="row">
            <label class="label-style">Search available Domains or Entities</label>
              <div class="col-md-9">
                <input
                  type="text"
                  class="form-control"
                  [(ngModel)]="searchText"
                />
              </div>
              <div class="col-md-3">
                <button class="btn btn-primary searchbtnstyle" (click)="onSearch(searchText)">
                  {{searchBtnName}}
                </button>
              </div>
            </div>
          </div>
          <!-- if clear is clicked div starts here   -->
          <div *ngIf="!clickedSearchBtn" class="overflow-scrollbar">
            <mat-accordion class="example-headers-align" multi>
              <div
                class="pad-bottom"
                *ngFor="let domain of selectedDomainName; let i; as: index"
              >
                <h4 class="headercss">{{ domain.domainName }}</h4>

                <div class="containerDesignleft">
                  <mat-expansion-panel
                    [expanded]="false"
                    *ngFor="let entity of domain.entities"
                    hideToggle
                    #panel
                  >
                    <mat-expansion-panel-header>
                      <mat-panel-title class="entitystyle">
                        <img
style="width:8%"
                          *ngIf="panel.expanded"
                          src="../../../assets/Open arrow.svg"
                        />
                        <img
style="width:8%"
                          *ngIf="!panel.expanded"
                          src="../../../assets/close arrow.svg"
                        />
                        &nbsp;{{ entity.entityName }}
                      </mat-panel-title>
                      <button
                        *ngIf="entity.entityDisableFlag === false"
                        class="btn btn-primary"
                        (click)="onAddAllClick(domain, entity)"
                      >
                        Add All
                      </button>
                      <button
                        *ngIf="entity.entityDisableFlag === true"
                        class="btn btn-success"
                        [disabled]="entity.entityDisableFlag"
                      >
                        Added<mat-icon [ngStyle]="{'color':'green'}">done</mat-icon>
                      </button>
                    </mat-expansion-panel-header>
                    <table
                      mat-table
                      [dataSource]="entity.entityAttributes"
                      class="mat-elevation-z8"
                    >
                      <!-- Name Column -->
                      <ng-container matColumnDef="attrName">
                        <td mat-cell *matCellDef="let element"  class="attrstyle">
                          <span
                            *ngIf="element?.dataType.toLowerCase() === 'string'"
                            ><img
                              id="pastchatview"
                              style="font-size: 1rem"
                              src="../../../assets/img/Character.svg"
                          /></span>
                          <span *ngIf="element?.dataType === 'number'"
                            ><img
                              id="pastchatview"
                              style="font-size: 1rem"
                              src="../../../assets/img/NUMBER.svg"
                          /></span>
                          <span *ngIf="element?.dataType === 'date'"
                            ><img
                              id="pastchatview"
                              style="font-size: 1rem"
                              src="../../../assets/img/Calendar today.svg"
                          /></span>
                          {{ element.attrName }}
                        </td>
                      </ng-container>

                      <!-- Weight Column -->
                      <ng-container
                        class="container-style"
                        matColumnDef="position"
                      >
                        <td mat-cell *matCellDef="let element">
                          <button
                            *ngIf="element.entityAttributeDisableFlag === false"
                            class="btn btn-primary"
                            [disabled]="element.entityAttributeDisableFlag"
                            (click)="onAddClick(element, entity, domain)"
                          >
                            Add
                          </button>
                          <button
                            *ngIf="element.entityAttributeDisableFlag === true"
                            class="btn btn-success"
                            [disabled]="element.entityAttributeDisableFlag"
                          >
                            Added<mat-icon [ngStyle]="{'color':'green'}">done</mat-icon>
                          </button>
                        </td>
                      </ng-container>
                      <tr
                        mat-row
                        *matRowDef="let row; columns: displayedColumns"
                      ></tr>
                    </table>
                  </mat-expansion-panel>
                </div>
              </div>
            </mat-accordion>
          </div>
          <!-- if clear is clicked div ends here   -->

          <!-- if search is clicked div starts here   -->
          <div *ngIf="clickedSearchBtn" class="overflow-scrollbar">
            <mat-accordion class="example-headers-align" multi>
              <div
                class="pad-bottom"
                *ngFor="let domain of searchTaggedResult; let i; as: index"
              >
                <h4 *ngIf="domain.tag" class="headercss">{{ domain.domainName }}</h4>

                <div class="containerDesignleft">
                  <mat-expansion-panel
                    [expanded]="false"
                    *ngFor="let entity of domain.entities"
                    hideToggle
                    #panel
                  >
                    <mat-expansion-panel-header>
                      <mat-panel-title class="entitystyle" *ngIf="entity.tag">
                        <img
style="width:8%"
                          *ngIf="panel.expanded"
                          src="../../../assets/Open arrow.svg"
                        />
                        <img
style="width:8%"
                          *ngIf="!panel.expanded"
                          src="../../../assets/close arrow.svg"
                        />
                        &nbsp;{{ entity.entityName }}
                      </mat-panel-title>
                      <button
                        *ngIf="entity.entityDisableFlag === false && entity.tag"
                        class="btn btn-primary"
                        (click)="onAddAllClick(domain, entity)"
                      >
                        Add All
                      </button>
                      <button
                        *ngIf="entity.entityDisableFlag === true && entity.tag"
                        class="btn btn-success"
                        [disabled]="entity.entityDisableFlag"
                      >
                        Added<mat-icon [ngStyle]="{'color':'green'}">done</mat-icon>
                      </button>
                    </mat-expansion-panel-header>
                    <table #table class="table">
                      <tbody *ngFor="let attr of entity.entityAttributes">
                        <tr *ngIf="attr.tag === true">
                          <td style="padding-top: 3%">
                            <span
                            *ngIf="attr?.dataType.toLowerCase() === 'string'"
                            ><img
                              id="pastchatview"
                              style="font-size: 1rem"
                              src="../../../assets/img/Character.svg"
                          /></span>
                          <span *ngIf="attr?.dataType === 'number'"
                            ><img
                              id="pastchatview"
                              style="font-size: 1rem"
                              src="../../../assets/img/NUMBER.svg"
                          /></span>
                          <span *ngIf="attr?.dataType === 'date'"
                            ><img
                              id="pastchatview"
                              style="font-size: 1rem"
                              src="../../../assets/img/Calendar today.svg"
                          /></span><span class="attrstyle"> {{ attr.attrName }}</span>
                          </td>
                          <!-- <td class="attrstyle">
                            {{ attr.attrName }}
                          </td> -->
                        </tr>
                      </tbody>
                    </table>
                  </mat-expansion-panel>
                </div>
              </div>
            </mat-accordion>
          </div>
          <!-- if search is clicked div ends here   -->
        </div>
        <!-- left pannel div code ends here -->
        <div  [hidden]="!showRightPanel" class="col-md-1" >
          <div class="headerDivider"></div>
           <!-- <mat-divider vertical class="divider-style"></mat-divider> -->
          </div>
        <!-- right pannel div code starts from here -->
        <div *ngIf="showRightPanel" class="col-md-5 containerDesign">
          <!-- clearall and selectors label div starts here -->
          <div class="container-fluid row mb-4">
            <div class="col-10" style="color: #b4b4b4">Selectors</div>

            <div class="col-2">
              <span  
                [matTooltipPosition]="'left'"
                [matTooltip]="disablePublishbtn ? const.clearTooltip : const.clearTooltip">
              <button
                type="button"
                class="btn btn-primary"
                [disabled]="disableClearAllBtn"
                (click)="clearAllSelectors()"
              >
                Clear All
              </button></span>
            </div>
          </div>
          <!-- clearall and selectors label div ends here -->
          <!-- no selectors content div starts here -->
          <div class="container-fluid overflow-scrollbar2">
            <div *ngIf="showNoDatasourceContent" class="rowmargin">
              <div class="row col-12 headercss">
                <div class=" textAlignment" style="color: #b4b4b4">
                  No DataSource Has been Added
                </div>
              </div>

              <div class="row col-12 rowboxcss">
                <div class="boxcss textAlignment" style="color: #b4b4b4">
                  You have not selected any Table or Column
                </div>
              </div>
            </div>
            <!-- no selectors content div ends here -->
            <mat-accordion class="example-headers-align" multi>
              <ng-container
                *ngFor="let domain of selectedDomainName; let m; as: index"
              >
                <h4
                  *ngIf="domain.displayDomainTargetPanel === true"
                  class="headercss"
                >
                  {{ domain.domainName }}
                </h4>
                <mat-expansion-panel
                  *ngFor="let entity of domain.entities; let n; as: index"
                  hideToggle
                  #panel1
                  [hidden]="!entity.displayEntityTargetPanel"
                >
                  <mat-expansion-panel-header>
                    <mat-panel-title class="entitystyle">
                      <img
style="width:8%"
                        *ngIf="panel1.expanded"
                        src="../../../assets/Open arrow.svg"
                      />
                      <img
style="width:8%"
                        *ngIf="!panel1.expanded"
                        src="../../../assets/close arrow.svg"
                      />
                      &nbsp;{{ entity.entityName }}
                    </mat-panel-title>
                  </mat-expansion-panel-header>

                  <table #table class="table">
                    <tbody *ngFor="let attr of entity.entityAttributes">
                      <tr *ngIf="attr.entityAttributeDisableFlag === true">
                        <td class="attrstyle">
                          {{ attr.attrName }}
                        </td>
                        <!-- <td>
                        <ng-container
                          *ngIf="
                            enableFields !== attr.attrSk;
                            else addressInputTpl
                          "
                        >
                          {{ attr.attrName }}
                        </ng-container>
                        <ng-template #addressInputTpl>
                          <input
                            type="text"
                            class="form-control"
                            [(ngModel)]="namechangeattrStr"
                          />
                        </ng-template>
                      </td> -->

                        <!-- <td *ngIf="enableFields">
                        <input
                          type="text"
                          class="form-control"
                          id="topicId"
                          [(ngModel)]="namechangeattrStr"
                        />
                      </td> -->

                        <td>
                          <select
                            [disabled]="enableFields !== attr.attrSk"
                            class="form-control"
                            name="miselect"
                            [(ngModel)]="attr.dataType"
                          >
                            <option
                              [value]="item.type"
                              *ngFor="let item of listofdatatype"
                            >
                              {{ item.type }}
                            </option>
                          </select>
                        </td>
                        <td style="padding-top: 3%">
                          <span
                            class="circletoimg"
                            *ngIf="enableFields === attr.attrSk"
                            ><span  
                            [matTooltipPosition]="'below'"
                            matTooltip="{{const?.saveDatatype}}"><img
                              (click)="onSave(attr, namechangeattrStr)"
                              id="pastchatview"
                              style="font-size: 1rem"
                              src="../../../assets/img/Save.svg"
                          /></span></span>
                          <span
                            class="circletoimg"
                            *ngIf="enableFields !== attr.attrSk"
                            ><span  
                            [matTooltipPosition]="'below'"
                            matTooltip="{{const?.editTooltip}}"><img
                              (click)="editEntityAttribute(attr)"
                              id="pastchatview"
                              style="font-size: 1rem"
                              src="../../../assets/img/edit.svg" /></span
                          ></span>&nbsp;
                          <span class="circletoimg"
                            ><span  
                            [matTooltipPosition]="'below'"
                            matTooltip="{{const?.deleteTooltip}}"><img
                              (click)="
                                deleteEntityAttribute(attr, entity, domain)
                              "
                              id="pastchatview"
                              style="font-size: 1rem"
                              src="../../../assets/img/delete.svg"
                          /></span></span>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </mat-expansion-panel>
              </ng-container>
            </mat-accordion>
            <ng-container>
              <div class="container-fluid row mt-4 mb-3" *ngIf="dataFlag">
                <div class="row col-10" style="color: #b4b4b4">Add Filter</div>

                <!-- <div class="col-2">
              <button
                type="button"
                class="btn btn-primary"
                (click)="onClickAdd()"
              >
                Add
              </button>
            </div> -->
              </div>

              <div *ngIf="dataFlag" class="row justify-content-center">
                <div class="col-md-11 containerDesign">
                  <div class="row">
                    <div class="col-md-12">
                      <div class="card-body">
                        <table #table class="table table-light table-striped">
                          <tbody
                            class="tbodycss"
                            *ngFor="let op of addedoperation; let i = index"
                          >
                            <tr>
                              <td
                                *ngIf="op.screen === 'basic'"
                                style="max-width: 224px; word-wrap: break-word"
                                class="card-text"
                              >
                                <b *ngIf="i != 0">{{ op.expression }}</b>

                                {{ op.datasource.domainName }} ,
                                {{ op.table.entityName }} ,

                                {{ op.column.attrName }} [ {{ op.operator }}
                                {{ op.condition }} ]
                              </td>
                              <td
                                *ngIf="op.screen === 'Advanced'"
                                style="max-width: 224px; word-wrap: break-word"
                                class="card-text"
                              >
                                {{ op.columnCalName }} {{ op.columnFormula }}
                              </td>
                              <td style="padding-top:3%">
                                <span class="circletoimg"
                                  ><span  
                                  [matTooltipPosition]="'below'"
                                  matTooltip="{{const?.showFilterTooltip}}"><img
                                    (click)="onClickEditFilter(op)"
                                    id="pastchatview"
                                    style="font-size: 1rem"
                                    src="../../../assets/img/edit.svg" /></span
                                ></span>&nbsp;
                                <span class="circletoimg"
                                  ><span  
                                  [matTooltipPosition]="'below'"
                                  matTooltip="{{const?.deleteFilterTooltip}}"><img
                                    (click)="onClickDeleteFilter(op)"
                                    id="pastchatview"
                                    style="font-size: 1rem"
                                    src="../../../assets/img/delete.svg"
                                /></span></span>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </ng-container>
            <!--Added join data show panel-->

            <ng-container>
              <div
                class="container-fluid row mt-4 mb-3"
                *ngIf="addedJoinoperation.length > 0"
              >
                <div class="row col-10" style="color: #b4b4b4">Add Join</div>
              </div>
              <div
                class="row justify-content-center"
                *ngIf="addedJoinoperation.length > 0"
              >
                <div class="col-md-11 containerDesign">
                  <div class="row">
                    <div class="col-md-12">
                      <div class="card-body">
                        <table #table class="table table-light table-striped">
                          <tbody
                            class="tbodycss"
                            *ngFor="let op of addedJoinoperation; let i = index"
                          >
                            <tr>
                              <td
                                style="max-width: 224px; word-wrap: break-word"
                                class="card-text"
                              >
                                {{ op.tableleft.entityName }} |
                                {{ op.columnleft.attrName }}

                                <b> {{ op.joinCondition }} </b>

                                {{ op.tableright.entityName }} |
                                {{ op.columnright.attrName }} [
                                {{ op.operator }}]
                              </td>

                              <td>
                                <span class="circletoimg"
                                  ><span  
                                  [matTooltipPosition]="'below'"
                                  matTooltip="{{const?.editJoinTooltip}}"><img
                                    (click)="onClickEditJoin(op)"
                                    id="pastchatview"
                                    style="font-size: 1rem"
                                    src="../../../assets/img/edit.svg" /></span
                                ></span>&nbsp;
                                <span class="circletoimg"
                                  ><span  
                                  [matTooltipPosition]="'below'"
                                  matTooltip="{{const?.deleteJoinTooltip}}"><img
                                    (click)="onClickDeleteJoin(op)"
                                    id="pastchatview"
                                    style="font-size: 1rem"
                                    src="../../../assets/img/delete.svg"
                                /></span></span>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </ng-container>
          </div>
        </div>
        <!-- right pannel div code ends here -->
      </div>
      <!-- preview and create manifest div starts here -->
      <div *ngIf="showRightPanel" class="row justify-content-end">
        <div class="col-2">
          <span  
            [matTooltipPosition]="'below'"
            [matTooltip]="disableJoinBtn ? const.joinTooltip : const.joinTooltip"><button type="button" (click)="onJoinClick()" class="btn btn-primary" [disabled]="disableJoinBtn">
            Add Join</button
          ></span>&nbsp;&nbsp;
          <span  
          [matTooltipPosition]="'below'"
          [matTooltip]="disableFilterBtn ? const.filterTooltip : const.filterTooltip">
          <button
            type="button"
            [disabled]="disableFilterBtn"
            (click)="openFilterDialog()"
            class="btn btn-primary"
          >
            Add Filter
          </button></span>
        </div>
      </div>
      <!-- preview and create manifest div ends here -->
    </div>
  </div>
</ng-container>
<ng-container *ngIf="openJoinComponent == true">
  <app-join-page
    (closeJoinComponent)="opentheJoinComp($event)"
    [editrowdata]="sendtheeditedData"
    [updatedList]="sendthewholwjoinList"
    [editFlag]="editClickedForJoin"
  ></app-join-page>
</ng-container>
